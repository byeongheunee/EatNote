<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.ssafy.eatnote.model.dao.NotificationDao">

	<!-- 알림 저장 -->
    <insert id="insert" parameterType="Notification">
        INSERT INTO notification (
            user_id,
            type_code,
            content,
            related_meal_id,
            is_read,
            created_at
        ) VALUES (
            #{userId},
            #{typeCode},
            #{content},
            #{relatedMealId},
            #{isRead},
            #{createdAt}
        )
    </insert>

	<!-- 알림 목록 조회 -->
	<select id="findByUserId" resultType="Notification">
	    SELECT *
	      FROM notification
	     WHERE user_id = #{userId}
	     ORDER BY created_at DESC
	</select>
	
	<!-- 특정 알림 읽음 처리 -->
	<update id="markAsRead">
	    UPDATE notification
	       SET is_read = TRUE
	     WHERE notification_id = #{notificationId}
	</update>
	
	<!-- 사용자의 안 읽은 알림 개수를 반환 -->
	<select id="countUnreadByUserId" resultType="int">
	    SELECT COUNT(*)
	      FROM notification
	     WHERE user_id = #{userId}
	       AND is_read = FALSE
	</select>
	
	<!-- 해당 사용자의 모든 알림 읽음 처리 -->
	<update id="markAllAsReadByUserId">
	    UPDATE notification
	       SET is_read = TRUE
	     WHERE user_id = #{userId}
	       AND is_read = FALSE
	</update>
</mapper>
