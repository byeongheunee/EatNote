<template>
  <div class="space-y-5">
    <!-- í•„ìˆ˜ í•­ëª© ì•ˆë‚´ -->
    <div class="required-notice">
      <div class="notice-icon">âš ï¸</div>
      <div class="notice-text">
        <strong>í•„ìˆ˜ ì…ë ¥ í•­ëª©</strong>ì„ ëª¨ë‘ ì‘ì„±í•´ì£¼ì„¸ìš”
        <div class="notice-items">ìê¸°ì†Œê°œ</div>
      </div>
    </div>

    <!-- ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ -->
    <div class="section-header">
      <h3 class="section-title">
        <span class="section-icon">ğŸ“‹</span>
        ê¸°ë³¸ ì •ë³´
      </h3>
      <p class="section-subtitle">íŠ¸ë ˆì´ë„ˆë¡œ í™œë™í•˜ê¸° ìœ„í•œ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
    </div>

    <!-- ì—°ë½ì²˜ & ì£¼ì†Œ -->
    <div class="grid grid-cols-1 gap-4">
      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸ“</span>
          ì—°ë½ì²˜ (ì„ íƒì‚¬í•­)
        </label>
        <input 
          v-model="model.phone" 
          type="tel" 
          class="form-input"
          placeholder="010-1234-5678"
          maxlength="13"
        />
      </div>

      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸ“</span>
          ì£¼ì†Œ (ì„ íƒì‚¬í•­)
        </label>
        <input 
          v-model="model.address" 
          type="text" 
          class="form-input"
          placeholder="ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬..."
        />
      </div>
    </div>

    <!-- í—¬ìŠ¤ì¥ ì •ë³´ ì„¹ì…˜ -->
    <div class="section-divider">
      <h4 class="subsection-title">
        <span class="subsection-icon">ğŸ‹ï¸</span>
        í—¬ìŠ¤ì¥ ì •ë³´
      </h4>
    </div>

    <!-- í—¬ìŠ¤ì¥ëª… & ì›¹ì‚¬ì´íŠ¸ -->
    <div class="grid grid-cols-1 gap-4">
      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸ¢</span>
          í—¬ìŠ¤ì¥ëª… (ì„ íƒì‚¬í•­)
        </label>
        <input 
          v-model="model.gymName" 
          type="text" 
          class="form-input"
          placeholder="í”¼íŠ¸ë‹ˆìŠ¤ì„¼í„°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
        />
      </div>

      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸŒ</span>
          í—¬ìŠ¤ì¥ ì›¹ì‚¬ì´íŠ¸ (ì„ íƒì‚¬í•­)
        </label>
        <input 
          v-model="model.gymWebsite" 
          type="url" 
          class="form-input"
          placeholder="https://..."
        />
      </div>
    </div>

    <!-- ìê²© ì •ë³´ ì„¹ì…˜ -->
    <div class="section-divider">
      <h4 class="subsection-title">
        <span class="subsection-icon">ğŸ†</span>
        ìê²© ì •ë³´
      </h4>
    </div>

    <!-- ìê²©ì¦ ë²ˆí˜¸ & ì‚¬ì—…ì ë²ˆí˜¸ -->
    <div class="grid grid-cols-1 gap-4">
      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸ–ï¸</span>
          ìê²©ì¦ ë²ˆí˜¸ (ì„ íƒì‚¬í•­)
        </label>
        <input 
          v-model="model.certificationNumber" 
          type="text" 
          class="form-input"
          placeholder="ìê²©ì¦ ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
        />
      </div>

      <!-- ìê²©ì¦ ì‚¬ì§„ -->
      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸ“¸</span>
          ìê²©ì¦ ì‚¬ì§„ (ì„ íƒì‚¬í•­)
        </label>
        <div class="file-upload-area" @click="$refs.certImageInput.click()">
          <div v-if="!certificationImageFile" class="file-upload-placeholder">
            <div class="text-4xl mb-3">ğŸ“œ</div>
            <p class="text-gray-700 font-medium text-lg">í´ë¦­í•´ì„œ ìê²©ì¦ ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</p>
            <p class="text-sm text-gray-500 mt-2">JPG, PNG íŒŒì¼ ì§€ì› (ìµœëŒ€ 10MB)</p>
            <p class="text-xs text-gray-400 mt-1">ìê²©ì¦ ì¸ì¦ì„ ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤</p>
          </div>
          <div v-else class="file-upload-selected">
            <div class="text-4xl mb-3">âœ…</div>
            <p class="text-green-700 font-medium text-lg">{{ certificationImageFile.name }}</p>
            <p class="text-sm text-gray-600 mt-2">íŒŒì¼ í¬ê¸°: {{ formatFileSize(certificationImageFile.size) }}</p>
            <p class="text-xs text-gray-500 mt-1">ë‹¤ë¥¸ íŒŒì¼ì„ ì„ íƒí•˜ë ¤ë©´ í´ë¦­í•˜ì„¸ìš”</p>
          </div>
        </div>
        <input 
          ref="certImageInput"
          type="file" 
          @change="handleCertImageChange" 
          class="hidden"
          accept="image/*"
        />
        <p v-if="certImageError" class="error-message">{{ certImageError }}</p>
      </div>

      <div class="form-group">
        <label class="form-label">
          <span class="label-icon">ğŸ“Š</span>
          ì‚¬ì—…ì ë²ˆí˜¸ (ì„ íƒì‚¬í•­)
        </label>
        <input 
          v-model="model.businessNumber" 
          type="text" 
          class="form-input"
          placeholder="000-00-00000"
          maxlength="12"
        />
      </div>
    </div>

    <!-- í”„ë¡œí•„ ì •ë³´ ì„¹ì…˜ -->
    <div class="section-divider">
      <h4 class="subsection-title">
        <span class="subsection-icon">ğŸ‘¤</span>
        í”„ë¡œí•„ ì •ë³´
      </h4>
    </div>

    <!-- ìê¸°ì†Œê°œ -->
    <div class="form-group">
      <label class="form-label required">
        <span class="label-icon">ğŸ’¬</span>
        ìê¸°ì†Œê°œ
      </label>
      <textarea 
        v-model="model.introduction" 
        class="form-textarea"
        :class="{ 'error': errors.introduction }"
        placeholder="ìì‹ ì„ ì†Œê°œí•˜ê³  íŠ¸ë ˆì´ë‹ ì² í•™ì„ ì•Œë ¤ì£¼ì„¸ìš”..."
        rows="4"
        maxlength="500"
      ></textarea>
      <div class="textarea-counter">
        {{ model.introduction?.length || 0 }}/500
      </div>
      <p v-if="errors.introduction" class="error-message">ìê¸°ì†Œê°œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.</p>
    </div>

    <!-- ê²½ë ¥ -->
    <div class="form-group">
      <label class="form-label">
        <span class="label-icon">ğŸ“ˆ</span>
        ê²½ë ¥ (ì„ íƒì‚¬í•­)
      </label>
      <textarea 
        v-model="model.career" 
        class="form-textarea"
        placeholder="ê´€ë ¨ ê²½ë ¥ì´ë‚˜ ê²½í—˜ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..."
        rows="3"
        maxlength="300"
      ></textarea>
      <div class="textarea-counter">
        {{ model.career?.length || 0 }}/300
      </div>
    </div>

    <!-- SNS ì •ë³´ ì„¹ì…˜ -->
    <div class="section-divider">
      <h4 class="subsection-title">
        <span class="subsection-icon">ğŸ“±</span>
        SNS ì •ë³´
      </h4>
    </div>

    <!-- ì¸ìŠ¤íƒ€ê·¸ë¨ URL -->
    <div class="form-group">
      <label class="form-label">
        <span class="label-icon">ğŸ“¸</span>
        ì¸ìŠ¤íƒ€ê·¸ë¨ URL (ì„ íƒì‚¬í•­)
      </label>
      <input 
        v-model="model.instagramUrl" 
        type="url" 
        class="form-input"
        placeholder="https://instagram.com/your_account"
      />
      <p class="input-help">íšŒì›ë“¤ì´ ë” ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ë„ì›€ì´ ë©ë‹ˆë‹¤</p>
    </div>

    <!-- ì…ë ¥ ì™„ë£Œ ì•ˆë‚´ -->
    <div v-if="isFormValid" class="completion-notice">
      <div class="completion-icon">âœ…</div>
      <div class="completion-text">
        <strong>ëª¨ë“  í•„ìˆ˜ ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤!</strong>
        <div class="completion-subtitle">íšŒì›ê°€ì…ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”</div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'

const model = defineModel()
const emit = defineEmits(['validation-change'])

// ìê²©ì¦ ì´ë¯¸ì§€ íŒŒì¼ ê´€ë ¨
const certificationImageFile = ref(null)
const certImageError = ref('')

// ìœ íš¨ì„± ê²€ì‚¬ ì—ëŸ¬ ìƒíƒœ
const errors = ref({
  introduction: false
})

// í¼ ìœ íš¨ì„± ê²€ì‚¬
const isFormValid = computed(() => {
  return model.value.introduction && 
         model.value.introduction.trim() !== ''
})

// í•„ìˆ˜ í•­ëª© ê²€ì¦ í•¨ìˆ˜
const validateForm = () => {
  errors.value.introduction = !model.value.introduction || model.value.introduction.trim() === ''
  
  return isFormValid.value
}

// ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì— ìœ íš¨ì„± ìƒíƒœ ì „ë‹¬
watch(isFormValid, (valid) => {
  emit('validation-change', valid)
}, { immediate: true })

// ëª¨ë¸ ê°’ ë³€ê²½ ì‹œ ì‹¤ì‹œê°„ ê²€ì¦
watch(() => model.value.introduction, () => {
  validateForm()
}, { deep: true })

// ì™¸ë¶€ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê²€ì¦ í•¨ìˆ˜ ë…¸ì¶œ
defineExpose({
  validateForm,
  isFormValid,
  getCertificationImageFile: () => certificationImageFile.value
})

// ìê²©ì¦ ì´ë¯¸ì§€ íŒŒì¼ ë³€ê²½ í•¸ë“¤ëŸ¬
const handleCertImageChange = (event) => {
  const file = event.target.files[0]
  certImageError.value = ''
  
  if (!file) {
    certificationImageFile.value = null
    return
  }
  
  // íŒŒì¼ í¬ê¸° ê²€ì¦ (10MB)
  const maxSize = 10 * 1024 * 1024 // 10MB
  if (file.size > maxSize) {
    certImageError.value = 'íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.'
    event.target.value = '' // íŒŒì¼ input ì´ˆê¸°í™”
    return
  }
  
  // íŒŒì¼ íƒ€ì… ê²€ì¦
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png']
  if (!allowedTypes.includes(file.type)) {
    certImageError.value = 'JPG, PNG íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
    event.target.value = '' // íŒŒì¼ input ì´ˆê¸°í™”
    return
  }
  
  certificationImageFile.value = file
}

// íŒŒì¼ í¬ê¸° í¬ë§·íŒ… í•¨ìˆ˜
const formatFileSize = (bytes) => {
  if (bytes === 0) return '0 Bytes'
  const k = 1024
  const sizes = ['Bytes', 'KB', 'MB', 'GB']
  const i = Math.floor(Math.log(bytes) / Math.log(k))
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i]
}

// ì—°ë½ì²˜ í¬ë§·íŒ… (í•˜ì´í”ˆ ìë™ ì¶”ê°€)
watch(() => model.value.phone, (newPhone) => {
  if (newPhone) {
    // ìˆ«ìë§Œ ì¶”ì¶œ
    const numbers = newPhone.replace(/[^0-9]/g, '')
    
    // í•˜ì´í”ˆ ì¶”ê°€
    if (numbers.length <= 3) {
      model.value.phone = numbers
    } else if (numbers.length <= 7) {
      model.value.phone = numbers.slice(0, 3) + '-' + numbers.slice(3)
    } else {
      model.value.phone = numbers.slice(0, 3) + '-' + numbers.slice(3, 7) + '-' + numbers.slice(7, 11)
    }
  }
})

// ì‚¬ì—…ì ë²ˆí˜¸ í¬ë§·íŒ… (í•˜ì´í”ˆ ìë™ ì¶”ê°€)
watch(() => model.value.businessNumber, (newNumber) => {
  if (newNumber) {
    // ìˆ«ìë§Œ ì¶”ì¶œ
    const numbers = newNumber.replace(/[^0-9]/g, '')
    
    // í•˜ì´í”ˆ ì¶”ê°€
    if (numbers.length <= 3) {
      model.value.businessNumber = numbers
    } else if (numbers.length <= 5) {
      model.value.businessNumber = numbers.slice(0, 3) + '-' + numbers.slice(3)
    } else {
      model.value.businessNumber = numbers.slice(0, 3) + '-' + numbers.slice(3, 5) + '-' + numbers.slice(5, 10)
    }
  }
})
</script>

<style scoped>
/* í•„ìˆ˜ í•­ëª© ì•ˆë‚´ */
.required-notice {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  background: linear-gradient(135deg, #dbeafe, #bfdbfe);
  border: 1px solid #3b82f6;
  border-radius: 12px;
  margin-bottom: 1.5rem;
}

.notice-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.notice-text {
  color: #1e40af;
  font-size: 0.9rem;
}

.notice-text strong {
  color: #1e3a8a;
}

.notice-items {
  font-size: 0.8rem;
  color: #2563eb;
  margin-top: 0.25rem;
}

/* ì„¹ì…˜ í—¤ë” */
.section-header {
  text-align: center;
  margin-bottom: 2rem;
}

.section-title {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  font-size: 1.5rem;
  font-weight: 700;
  color: #374151;
  margin-bottom: 0.5rem;
}

.section-icon {
  font-size: 1.75rem;
}

.section-subtitle {
  color: #6b7280;
  font-size: 0.95rem;
}

/* ì„¹ì…˜ êµ¬ë¶„ì„  */
.section-divider {
  margin: 2rem 0 1.5rem 0;
  padding-top: 1.5rem;
  border-top: 1px solid #e5e7eb;
}

.subsection-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 1.2rem;
  font-weight: 600;
  color: #4b5563;
  margin-bottom: 1rem;
}

.subsection-icon {
  font-size: 1.25rem;
}

/* í¼ ê·¸ë£¹ */
.form-group {
  animation: slideInUp 0.4s ease-out;
}

.form-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  font-weight: 600;
  color: #374151;
  margin-bottom: 0.75rem;
}

.form-label.required::after {
  content: "*";
  color: #ef4444;
  margin-left: 0.25rem;
}

.label-icon {
  font-size: 1.1rem;
}

.form-input {
  width: 100%;
  padding: 0.875rem 1rem;
  background-color: rgba(255, 255, 255, 0.9);
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  outline: none;
}

.form-input:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  background-color: #ffffff;
}

.form-input.error {
  border-color: #ef4444;
  background-color: rgba(254, 242, 242, 0.9);
}

.form-input.error:focus {
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

.form-input::placeholder {
  color: #9ca3af;
}

/* í…ìŠ¤íŠ¸ ì—ë¦¬ì–´ */
.form-textarea {
  width: 100%;
  padding: 0.875rem 1rem;
  background-color: rgba(255, 255, 255, 0.9);
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  outline: none;
  resize: vertical;
  min-height: 100px;
  font-family: inherit;
  line-height: 1.6;
}

.form-textarea:focus {
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  background-color: #ffffff;
}

.form-textarea::placeholder {
  color: #9ca3af;
}

/* í…ìŠ¤íŠ¸ ì¹´ìš´í„° */
.textarea-counter {
  text-align: right;
  font-size: 0.8rem;
  color: #6b7280;
  margin-top: 0.5rem;
}

/* ì…ë ¥ ë„ì›€ë§ */
.input-help {
  font-size: 0.8rem;
  color: #6b7280;
  margin-top: 0.5rem;
  font-style: italic;
}

/* ì™„ë£Œ ì•ˆë‚´ */
.completion-notice {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 1.25rem;
  background: linear-gradient(135deg, #d1fae5, #a7f3d0);
  border: 1px solid #10b981;
  border-radius: 12px;
  margin-top: 1.5rem;
}

.completion-icon {
  font-size: 1.5rem;
  flex-shrink: 0;
}

.completion-text {
  color: #065f46;
  font-size: 0.9rem;
}

.completion-text strong {
  color: #064e3b;
}

.completion-subtitle {
  font-size: 0.8rem;
  color: #047857;
  margin-top: 0.25rem;
}

/* ë©”ì‹œì§€ */
.error-message {
  color: #dc2626;
  font-size: 0.85rem;
  margin-top: 0.5rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.error-message::before {
  content: "âš ï¸";
  font-size: 0.75rem;
}

/* íŒŒì¼ ì—…ë¡œë“œ ì˜ì—­ */
.file-upload-area {
  width: 100%;
  padding: 2rem;
  background-color: rgba(255, 255, 255, 0.8);
  border: 2px dashed #d1d5db;
  border-radius: 16px;
  cursor: pointer;
  text-align: center;
  transition: all 0.3s ease;
  min-height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.file-upload-area:hover {
  border-color: #3b82f6;
  background-color: rgba(255, 255, 255, 0.95);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
}

.file-upload-placeholder,
.file-upload-selected {
  transition: all 0.3s ease;
  width: 100%;
}

.file-upload-placeholder .text-4xl,
.file-upload-selected .text-4xl {
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
}

.file-upload-area:hover .file-upload-placeholder .text-4xl,
.file-upload-area:hover .file-upload-selected .text-4xl {
  transform: scale(1.1);
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
}

/* ì• ë‹ˆë©”ì´ì…˜ */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ë°˜ì‘í˜• */
@media (max-width: 768px) {
  .form-input, .form-textarea {
    font-size: 16px; /* iOS zoom ë°©ì§€ */
  }
  
  .section-title {
    font-size: 1.3rem;
  }
  
  .subsection-title {
    font-size: 1.1rem;
  }
  
  .grid.grid-cols-2 {
    grid-template-columns: 1fr;
  }
  
  .file-upload-area {
    padding: 1.5rem;
    min-height: 120px;
  }
  
  .file-upload-placeholder .text-lg,
  .file-upload-selected .text-lg {
    font-size: 1rem;
  }
}

/* í¬ì»¤ìŠ¤ ë§ ì œê±° */
*:focus {
  outline: none;
}

/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
.form-textarea::-webkit-scrollbar {
  width: 6px;
}

.form-textarea::-webkit-scrollbar-track {
  background: #f1f5f9;
  border-radius: 3px;
}

.form-textarea::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 3px;
}

.form-textarea::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}
</style>